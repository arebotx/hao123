---
/**
 * ç®¡ç†é¡µé¢
 * åå°ç®¡ç†ç³»ç»Ÿçš„ä¸»å…¥å£é¡µé¢ï¼Œé›†æˆæ‰€æœ‰ç®¡ç†åŠŸèƒ½
 * @author Claude 4.0 sonnet
 * @version 1.0.0
 */

import AdminLayout from '../layouts/AdminLayout.astro';
import AuthIsland from '../Island/AuthIsland.jsx';
import AdminIsland from '../Island/AdminIsland.jsx';
import BookmarkManagerIsland from '../Island/BookmarkManagerIsland.jsx';
import CategoryManagerIsland from '../Island/CategoryManagerIsland.jsx';
import ImportExportIsland from '../Island/ImportExportIsland.jsx';
import AIOrganizeIsland from '../Island/AIOrganizeIsland.jsx';
import StatsIsland from '../Island/StatsIsland.jsx';
import AdvancedStatsIsland from '../Island/AdvancedStatsIsland.jsx';
import UIEnhancementIsland from '../Island/UIEnhancementIsland.jsx';

// é¡µé¢å…ƒæ•°æ®
const pageTitle = "Cloudnav åå°ç®¡ç†";
const pageDescription = "Cloudnav å¯¼èˆªç«™åå°ç®¡ç†ç³»ç»Ÿï¼Œæä¾›ä¹¦ç­¾ç®¡ç†ã€åˆ†ç±»æ•´ç†ã€AI æ™ºèƒ½åˆ†ç±»ã€æ•°æ®ç»Ÿè®¡ç­‰åŠŸèƒ½ã€‚";
---

<AdminLayout title={pageTitle} description={pageDescription}>
  <!-- è®¤è¯ä¿æŠ¤çš„ç®¡ç†ç•Œé¢ -->
  <AuthIsland client:load>
    <!-- ä¸»ç®¡ç†ç•Œé¢ -->
    <div id="admin-main" class="min-h-screen">
      <!-- ç®¡ç†å¯¼èˆªå’Œå†…å®¹ -->
      <AdminIsland client:load />
      
      <!-- éšè—çš„ç®¡ç†ç»„ä»¶ï¼Œé€šè¿‡ AdminIsland æ§åˆ¶æ˜¾ç¤º -->
      <div style="display: none;">
        <!-- ä¹¦ç­¾ç®¡ç†ç»„ä»¶ -->
        <div id="bookmark-manager">
          <BookmarkManagerIsland client:visible />
        </div>
        
        <!-- åˆ†ç±»ç®¡ç†ç»„ä»¶ -->
        <div id="category-manager">
          <CategoryManagerIsland client:visible />
        </div>
        
        <!-- å¯¼å…¥å¯¼å‡ºç»„ä»¶ -->
        <div id="import-export">
          <ImportExportIsland client:visible />
        </div>
        
        <!-- AI æ•´ç†ç»„ä»¶ -->
        <div id="ai-organize">
          <AIOrganizeIsland client:visible />
        </div>
        
        <!-- ç»Ÿè®¡åˆ†æç»„ä»¶ */
        <div id="stats">
          <StatsIsland client:visible />
        </div>
        
        <!-- é«˜çº§ç»Ÿè®¡ç»„ä»¶ -->
        <div id="advanced-stats">
          <AdvancedStatsIsland client:visible />
        </div>
      </div>
    </div>

    <!-- UI å¢å¼ºåŠŸèƒ½ -->
    <UIEnhancementIsland client:load />
  </AuthIsland>
</AdminLayout>

<script>
  // ç®¡ç†é¡µé¢çš„å®¢æˆ·ç«¯è„šæœ¬
  document.addEventListener('DOMContentLoaded', () => {
    console.log('ğŸ”§ ç®¡ç†é¡µé¢å·²åŠ è½½');
    
    // é¡µé¢è®¿é—®ç»Ÿè®¡
    if (typeof window !== 'undefined' && window.stats) {
      window.stats.pageView('/admin');
    }
    
    // ç®¡ç†é¡µé¢ç‰¹å®šçš„åŠŸèƒ½
    initAdminPage();
  });
  
  /**
   * åˆå§‹åŒ–ç®¡ç†é¡µé¢
   */
  function initAdminPage() {
    // è®¾ç½®é¡µé¢æ ‡é¢˜
    document.title = 'Cloudnav åå°ç®¡ç†';
    
    // æ·»åŠ ç®¡ç†é¡µé¢çš„é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', handleKeyboardShortcuts);
    
    // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
    document.addEventListener('visibilitychange', handleVisibilityChange);
    
    // è®¾ç½®é¡µé¢ç¦»å¼€ç¡®è®¤
    window.addEventListener('beforeunload', handleBeforeUnload);
  }
  
  /**
   * å¤„ç†é”®ç›˜å¿«æ·é”®
   */
  function handleKeyboardShortcuts(event) {
    // Ctrl/Cmd + K: å¿«é€Ÿæœç´¢
    if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
      event.preventDefault();
      // è§¦å‘æœç´¢åŠŸèƒ½
      console.log('å¿«æ·é”®ï¼šå¿«é€Ÿæœç´¢');
    }
    
    // Ctrl/Cmd + S: ä¿å­˜å½“å‰æ“ä½œ
    if ((event.ctrlKey || event.metaKey) && event.key === 's') {
      event.preventDefault();
      // è§¦å‘ä¿å­˜åŠŸèƒ½
      console.log('å¿«æ·é”®ï¼šä¿å­˜æ“ä½œ');
    }
    
    // Esc: å…³é—­æ¨¡æ€æ¡†æˆ–è¿”å›
    if (event.key === 'Escape') {
      // å¤„ç† Esc é”®é€»è¾‘
      console.log('å¿«æ·é”®ï¼šEsc');
    }
  }
  
  /**
   * å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–
   */
  function handleVisibilityChange() {
    if (document.hidden) {
      console.log('ç®¡ç†é¡µé¢å·²éšè—');
    } else {
      console.log('ç®¡ç†é¡µé¢å·²æ˜¾ç¤º');
      // é¡µé¢é‡æ–°æ˜¾ç¤ºæ—¶åˆ·æ–°æ•°æ®
      refreshAdminData();
    }
  }
  
  /**
   * å¤„ç†é¡µé¢ç¦»å¼€å‰çš„ç¡®è®¤
   */
  function handleBeforeUnload(event) {
    // æ£€æŸ¥æ˜¯å¦æœ‰æœªä¿å­˜çš„æ›´æ”¹
    const hasUnsavedChanges = checkUnsavedChanges();
    
    if (hasUnsavedChanges) {
      event.preventDefault();
      event.returnValue = 'æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
      return event.returnValue;
    }
  }
  
  /**
   * æ£€æŸ¥æ˜¯å¦æœ‰æœªä¿å­˜çš„æ›´æ”¹
   */
  function checkUnsavedChanges() {
    // è¿™é‡Œå¯ä»¥æ£€æŸ¥å„ä¸ªç®¡ç†ç»„ä»¶çš„çŠ¶æ€
    // æš‚æ—¶è¿”å› false
    return false;
  }
  
  /**
   * åˆ·æ–°ç®¡ç†æ•°æ®
   */
  function refreshAdminData() {
    // è§¦å‘å„ä¸ªç»„ä»¶çš„æ•°æ®åˆ·æ–°
    console.log('åˆ·æ–°ç®¡ç†æ•°æ®');
  }
  
  // å…¨å±€é”™è¯¯å¤„ç†
  window.addEventListener('error', (event) => {
    console.error('ç®¡ç†é¡µé¢é”™è¯¯:', event.error);
    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é”™è¯¯ä¸ŠæŠ¥é€»è¾‘
  });
  
  // æœªå¤„ç†çš„ Promise æ‹’ç»
  window.addEventListener('unhandledrejection', (event) => {
    console.error('æœªå¤„ç†çš„ Promise æ‹’ç»:', event.reason);
    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é”™è¯¯ä¸ŠæŠ¥é€»è¾‘
  });
</script>

<style>
  /* ç®¡ç†é¡µé¢ç‰¹å®šæ ·å¼ */
  #admin-main {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    min-height: 100vh;
  }
  
  .dark #admin-main {
    background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
  }
  
  /* ç»„ä»¶å®¹å™¨æ ·å¼ */
  #admin-main > div {
    transition: all 0.3s ease-in-out;
  }
  
  /* å“åº”å¼è®¾è®¡ */
  @media (max-width: 768px) {
    #admin-main {
      padding: 0.5rem;
    }
  }
  
  /* åŠ è½½çŠ¶æ€æ ·å¼ */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }
  
  .dark .loading-overlay {
    background: rgba(26, 32, 44, 0.9);
  }
  
  /* ç®¡ç†ç»„ä»¶çš„é€šç”¨æ ·å¼ */
  .admin-component {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  .dark .admin-component {
    background: rgba(45, 55, 72, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }
  
  /* åŠ¨ç”»æ•ˆæœ */
  .slide-in {
    animation: slideIn 0.3s ease-out;
  }
  
  @keyframes slideIn {
    from {
      transform: translateX(-100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  .fade-in-up {
    animation: fadeInUp 0.5s ease-out;
  }
  
  @keyframes fadeInUp {
    from {
      transform: translateY(30px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  /* æˆåŠŸ/é”™è¯¯æç¤ºæ ·å¼ */
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 20px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    z-index: 10000;
    animation: slideInRight 0.3s ease-out;
  }
  
  .notification.success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  }
  
  .notification.error {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  }
  
  .notification.warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  }
  
  .notification.info {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  }
  
  @keyframes slideInRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
</style>
